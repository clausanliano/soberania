<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Soberania</title>
  <style>
    body { margin: 0; overflow: hidden; background: #e0f7fa; }
    canvas { display: block; margin: 0 auto; background: #fff; border: 2px solid #000; }
    #btnIniciar {padding: 15px 30px; font-size: 18px; cursor: pointer; margin-top: 20px; }
    #telaInicial {max-width: 800px; margin: 0 auto; padding: 20px; text-align: center; background: #fefefe; border: 2px solid #000;}
    #barraBotao {text-align: center; margin-top: 40px;}
  </style>
</head>
<body>
    <h1 style="text-align: center;">Soberania !!!</h1>

    <!-- üî∞ Tela Inicial com Regras -->
    <div id="telaInicial">
      <h2>üìú Origem do Jogo</h2>
      <p>Este jogo foi desenvolvido como trabalho final do <strong>curso de JavaScript b√°sico</strong>, ministrado pelo professor <strong>Kelyson Nunes</strong> (contratem ele, o homem √© bom!).</p>
      <p>A proposta do jogo surgiu de forma bem-humorada, como uma cr√≠tica criativa √†s <em>san√ß√µes norte-americanas</em> ao Brasil. A ideia divertida contribuiu (assim espero) para uma boa nota!</p>

      <h2>üéØ Objetivo da Publica√ß√£o</h2>
      <p>Devido ao sucesso da apresenta√ß√£o em sala de aula, resolvi publicar este c√≥digo para ajudar algu√©m que <strong>est√° realmente precisando</strong>.</p>
      <p>Se voc√™ puder colaborar, doe qualquer valor para apoiar essa causa: <a href="https://www.vakinha.com.br/vaquinha/todos-por-rafinha" target="_blank">Todos por Rafinha - Clique aqui para doar</a>.</p>
      <p><strong>Doe, compartilhe, divirta-se e ajude o pr√≥ximo. Obrigado!</strong></p>

      <h2>üéÆ Regras do Jogo</h2>
      <p>O objetivo do jogo √© simples: <strong>escapar das marcas americanas</strong> e escolher apenas <strong>marcas chinesas</strong> movendo-se para direita ou para esquerda.</p>
      <p>Al√©m de divertido, o jogo tamb√©m tem um lado educativo, pois muitos colegas da turma descobriram marcas chinesas que at√© ent√£o nunca ouviram falar.</p>
      <p>Para ganhar ... na verdade voc√™ nunca ganha, porque ningu√©m ganha para os EUA (ou porque n√£o tive tempo suficente para terminar o jogo... vai saber...)</p>

    </div>

    <!-- üî≥ Canvas do jogo oculto inicialmente -->
    <canvas id="cnvJogo" width="800" height="600" style="display: none;"></canvas>

    <div id="barraBotao">
        <button id="btnIniciar" style="padding: 15px 30px; font-size: 18px; cursor: pointer;">
            Iniciar Jogo
        </button>
    </div>
    
<script>

class CarregadorImagens {
  static carregar(lista_marcas, nome_pasta, funcao_callback) {
    let images = [];
    let loaded = 0;

    lista_marcas.forEach(marca => {
      const img = new Image(100, 100);
      img.src = nome_pasta + marca + '.png';
      img.onload = () => {
        images.push(img);
        loaded++;
        if (loaded === lista_marcas.length) {
          funcao_callback(images);
        }
      };
    });
  }
}


class CarregadorImagens2 {
  static carregar(links_imagens, funcao_callback) {
    let images = [];
    let loaded = 0;

    links_imagens.forEach(link => {
      const img = new Image(100, 100);
      img.src = link;
      img.onload = () => {
        images.push(img);
        loaded++;
        if (loaded === links_imagens.length) {
          funcao_callback(images);
        }
      };
      img.onerror = () => {
        console.error(`Erro ao carregar imagem: ${link}`);
        loaded++;
        if (loaded === links_imagens.length) {
          funcao_callback(images);
        }
      };
    });
  }
}




class Jogador {
  constructor(img, x, y) {
    this.img = img;
    this.x = x;
    this.y = y;
    this.width = 60;
    this.height = 60;
    this.velocidade = 7;
    this.vidas = 2;
  }

  moverJogador(direction) {
    if (direction === 'left') this.x -= this.velocidade;
    else if (direction === 'right') this.x += this.velocidade;
    this.x = Math.max(0, Math.min(canvas.width - this.width, this.x));
  }

  desenhaAvatar(ctx) {
    ctx.drawImage(this.img, this.x, this.y, this.width, this.height);
  }
}

class Logotipo {
  constructor(img, paisEmpresa) {
    this.img = img;
    this.paisEmpresa = paisEmpresa; // 'china' ou 'eua'
    this.x = Math.random() * (canvas.width - 50);
    this.y = -50;
    this.size = 30 + Math.random() * 50;
    this.velocidade = 3 + Math.random() * 5;
  }

  atualizaLogo() {
    this.y += this.velocidade;
  }

  desenhaLogotipo(ctx) {
    ctx.drawImage(this.img, this.x, this.y, this.size, this.size);
  }

  verificaColisao(jogador) {
    return this.x < jogador.x + jogador.width &&
           this.x + this.size > jogador.x &&
           this.y < jogador.y + jogador.height &&
           this.y + this.size > jogador.y;
  }
}

class Jogo {
  constructor(ctx) {
    this.ctx = ctx; // contexto do Canva (CanvasRenderingContext2D)
    this.avatar = new Image();
    this.avatar.src = 'boneco.png';
    this.jogador = new Jogador(this.avatar, 400, 500);
    this.chinaLogos = [];
    this.euaLogos = [];
    this.logos = [];
    this.keys = {};
    this.frequenciaCriacaoLogo = 100;
    this.timer = 0;
    this.nivel = 1;

    this.avatar.onload = () => this.loop(); //quando carregar o boneco 

    document.addEventListener('keydown', e => this.keys[e.key] = true);
    document.addEventListener('keyup', e => this.keys[e.key] = false);

    //const marcas_china = ['byd', 'huawei', 'luxgen', 'faw', 'hongqi', 'baic', 'dfm', 'great_wall', 'brilliance', 'haima', 'qoros'];
    //CarregadorImagens.carregar(marcas_china, 'logos/china/', imgs => this.chinaLogos = imgs);

    //const marcas_eua = ['bic', 'fedex', 'bmw', 'dell', 'texaco', 'colgate', 'mobil', 'visa', 'mastercard', 'paypal', 'american_express'];
    //CarregadorImagens.carregar(marcas_eua, 'logos/eua/', imgs => this.euaLogos = imgs);


    const links_eua = [
      "https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg",
      "https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/Microsoft_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/UnitedHealth_Group%2C_Inc._logo.png",
      "https://commons.wikimedia.org/wiki/Special:FilePath/Walmart_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/Google_2015_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/ExxonMobil_Logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/IBM_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/Cisco_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/McDonald%27s_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/PepsiCo_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/Coca-Cola_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/General_Motors_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/Dell_Technologies_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/Visa_Inc._logo.svg",  
      "https://commons.wikimedia.org/wiki/Special:FilePath/Bic_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/Shell_wordmark_2019.svg", 
      "https://commons.wikimedia.org/wiki/Special:FilePath/Walmart_logo_%282025%29.svg", 
      "https://commons.wikimedia.org/wiki/Special:FilePath/Apple_logo_black.svg", 
      "https://commons.wikimedia.org/wiki/Special:FilePath/Microsoft_logo.svg", 
      "https://commons.wikimedia.org/wiki/Special:FilePath/Google_2015_logo.svg", 
      "https://commons.wikimedia.org/wiki/Special:FilePath/ExxonMobil_Logo.svg", 
    ];

    CarregadorImagens2.carregar(links, imgs => this.chinaLogos = imgs);

    const linksChinese = [
      "https://commons.wikimedia.org/wiki/Special:FilePath/BYD_Auto_2022_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/Chery_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/Great_Wall_Motor_2025_logo.png",
      "https://commons.wikimedia.org/wiki/Special:FilePath/Shein-logo.png", 
      "https://commons.wikimedia.org/wiki/Special:FilePath/Alibaba_en_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/XCMG_logo.svg",
      "https://commons.wikimedia.org/wiki/Special:FilePath/ICar_logo.svg",
      "https://upload.wikimedia.org/wikipedia/en/0/04/Huawei_Standard_logo.svg"
    ];

    CarregadorImagens2.carregar(links, imgs => this.chinaLogos = imgs);

  }

  atualizaJogo() {
    if (this.keys['ArrowLeft']) this.jogador.moverJogador('left');
    if (this.keys['ArrowRight']) this.jogador.moverJogador('right');

    this.timer++;
    if (this.timer % this.frequenciaCriacaoLogo === 0) {
      this.geraLogo();
    }

    this.logos.forEach(logo => logo.atualizaLogo());
    this.processaColisao();
    this.apagaLogoFinalTela();

    // Aumenta dificuldade a cada 10s
    if (this.timer % 600 === 0 && this.frequenciaCriacaoLogo > 20) {
      this.nivel++;
      this.frequenciaCriacaoLogo -= 10;
    }
  }

  desenhaJogo() {
    this.ctx.clearRect(0, 0, canvas.width, canvas.height);
    this.jogador.desenhaAvatar(this.ctx);
    this.logos.forEach(logo => logo.desenhaLogotipo(this.ctx));
    this.ctx.fillStyle = '#000';
    this.ctx.font = '20px Arial';
    this.ctx.fillText(`Pontos: ${this.jogador.vidas}`, 10, 20);
    this.ctx.fillText(`N√≠vel: ${this.nivel}`, 700, 20);
  }

  geraLogo() {
    const nomePais = Math.random() < 0.1 ? 'china' : 'eua';
    const img = nomePais === 'china' ? this.escolherLogoAleatoriamente(this.chinaLogos) : this.escolherLogoAleatoriamente(this.euaLogos);
    this.logos.push(new Logotipo(img, nomePais));
  }

  escolherLogoAleatoriamente(listaLogotipo) {
    return listaLogotipo[Math.floor(Math.random() * listaLogotipo.length)];
  }

  processaColisao() {
    this.logos.forEach((logo, idx) => {
      if (logo.verificaColisao(this.jogador)) {
        if (logo.paisEmpresa === 'china') {
            this.jogador.vidas++;
        } else { 
            this.jogador.vidas-=2;
        }
        this.logos.splice(idx, 1);  // se colidiu no avatar, apague
      }
    });
  }

  apagaLogoFinalTela() {
    this.logos = this.logos.filter(item => item.y < canvas.height); // se colidiu na base, apague
  }

  loop() {
    if (this.jogador.vidas <= 0) {
      this.ctx.fillStyle = '#f00';
      this.ctx.font = '50px Arial';
      this.ctx.fillText('GAME OVER', 250, 300);
      return;
    }
    this.atualizaJogo();
    this.desenhaJogo();
    requestAnimationFrame(() => this.loop()); //criar anima√ß√µes suaves e eficientes no navegador 60hz
  }
}

const canvas = document.getElementById('cnvJogo');
const btnIniciar = document.getElementById('btnIniciar');
const telaInicial = document.getElementById('telaInicial');

btnIniciar.onclick = () => {
  telaInicial.style.display = 'none';      // esconde tela de regras
  canvas.style.display = 'block';          // mostra o jogo
  new Jogo(canvas.getContext('2d'));       // inicia o jogo
};



//const btnIniciar = document.getElementById('btnIniciar');
//btnIniciar.onclick = () => {
  // Cria uma nova inst√¢ncia do jogo (reinicia)
  //new Jogo(canvas.getContext('2d'));
//};

</script>
</body>
</html>
